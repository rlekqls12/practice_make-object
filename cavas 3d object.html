<!DOCTYPE html>
<html>
	<head>
		<title> 3D </title>
		<script>
			var keys = [], canvas, ctx, gcan;

			window.onkeyup = function() {
				var key = event.key;
				if (keys.indexOf(key) != -1)
					for (var i = 0, len = keys.length; i < len; i++) {
						if (keys[i] == key) {
							keys.splice(i, 1);
							return;
						}
					}
			}

			window.onkeydown = function() {
				var key = event.key;
				if (keys.indexOf(key) == -1)
					keys.push(key);
			}

			window.onresize = function() {
				canvas.style.cssText += 'left: ' + (window.innerWidth/2 - 251) + 'px; top: ' + (window.innerHeight/2 - 251) + 'px;';
			}

			window.onload = function() {
				canvas = document.createElement('canvas');
				canvas.width = canvas.height = 500;
				canvas.style.cssText = 'border: green 1px solid; position: absolute; background-color: #fff; left: ' + (window.innerWidth/2 - 251) + 'px; top: ' + (window.innerHeight/2 - 251) + 'px;';
				document.body.appendChild(canvas);

				ctx = canvas.getContext('2d');
				gcan = new Game();
				gcan.Init();
			}

			function Game() {
				// 기본 변수
				let camera = {x: canvas.width/2, y: canvas.height/2, z: -25, w: canvas.width, h: canvas.height, v: 1, rX: 0, rY: 0, sX: 1, sY: 1, sZ: 1};
				let box_sprite_arr = [[0,1,2,3],[4,5,6,7],[4,5,1,0],[7,6,2,3],[0,4,7,3],[1,5,6,2]];//앞 뒤 위 아래 왼 오
				
				// 객체 변수
				let box_1 = {x: 250, y: 250, z: 0, w: 25, h: 25, v: 25, rX: 0, rY: 0, sX: 1, sY: 1, sZ: 1, color: 'green', sprite: []};

				this.settingBox = function(box) {
					//A B C D E F G H
					box.sprite[0] = [box.x - box.w, box.y - box.h, box.z - box.v];
					box.sprite[1] = [box.x + box.w, box.y - box.h, box.z - box.v];
					box.sprite[2] = [box.x + box.w, box.y + box.h, box.z - box.v];
					box.sprite[3] = [box.x - box.w, box.y + box.h, box.z - box.v];
					box.sprite[4] = [box.x - box.w, box.y - box.h, box.z + box.v];
					box.sprite[5] = [box.x + box.w, box.y - box.h, box.z + box.v];
					box.sprite[6] = [box.x + box.w, box.y + box.h, box.z + box.v];
					box.sprite[7] = [box.x - box.w, box.y + box.h, box.z + box.v];

					/*let distX = 0, distY = 0, t = [], pmX = 0, pmY = 0;

					for (let i = 0; i < 8; i++) {
						t = box.sprite[i];
						distX = (camera.x - t[0])*(camera.x - t[0]) + (camera.z - t[2])*(camera.z - t[2]);
						distY = (camera.y - t[1])*(camera.y - t[1]) + (camera.z - t[2])*(camera.z - t[2]);
						pmX = (distX < 0 ? -1 : 1);
						distX = (distX < 0 ? Math.sqrt(-distX) : Math.sqrt(distX));
						pmY = (distY < 0 ? -1 : 1);
						distY = (distY < 0 ? Math.sqrt(-distY) : Math.sqrt(distY));
						box.sprite[i] = [t[0] + distY * pmX, t[1] + distX * pmY, t[2]];
					}*/
					
				}

				this.drawBox = function(box) {
					if (box.sprite.length != 8) {
						console.log(box);
						console.log('errMsg : 위 객체는 obj_box 형식이 아닙니다. [sprite.length < 8]');
					} else {
						let spr = box.sprite;
						for (let i = 0; i < 1; i++) {
							let arr = box_sprite_arr[i];

							ctx.strokeStyle = 'black';
							ctx.lineWidth = 0.5;
							ctx.fillStyle = box.color;

							switch(i) {
								case 0:
								case 1:
									ctx.fillStyle = 'green';
								break;
								case 2:
								case 3:
									ctx.fillStyle = 'blue';
								break;
								case 4:
								case 5:
									ctx.fillStyle = 'red';
								break;
							}

							let gx = [], gy = [];
							for (let j = 0; j < 4; j++) {
								gx[j] = ((spr[arr[j]][0] * Math.cos(spr[arr[j]][0] - camera.x)) + (spr[arr[j]][1] * Math.sin(spr[arr[j]][2] - camera.z)));
								gy[j] = ((spr[arr[j]][1] * Math.sin(spr[arr[j]][1] - camera.y)) + (spr[arr[j]][0] * Math.cos(spr[arr[j]][2] - camera.z)));
							}

							ctx.beginPath();
							ctx.moveTo(gx[0], gy[0]);
							ctx.lineTo(gx[1], gy[1]);
							ctx.lineTo(gx[2], gy[2]);
							ctx.lineTo(gx[3], gy[3]);
							ctx.stroke();
							ctx.fill();
							ctx.closePath();
						}
					}
				}

				this.clearCanvas = function() {
					ctx.clearRect(0, 0, canvas.width, canvas.height);
				}

				this.Init = function() {	
					this.settingBox(box_1);
					this.drawBox(box_1);
					setInterval(function() {
						let d = 0;
						if (keys.indexOf('w') != -1) {
							box_1.y -= 5; d = 1;
						}
						if (keys.indexOf('s') != -1) {
							box_1.y += 5; d = 1;
						}
						if (keys.indexOf('a') != -1) {
							box_1.x -= 5; d = 1;
						}
						if (keys.indexOf('d') != -1) {
							box_1.x += 5; d = 1;
						}
						if (keys.indexOf('r') != -1) {
							box_1.z -= 5; d = 1;
						}
						if (keys.indexOf('f') != -1) {
							box_1.z += 5; d = 1;
						}
						gcan.clearCanvas();
						gcan.settingBox(box_1);
						gcan.drawBox(box_1);
						if (d == 1) {
							console.log('x: ' + box_1.x + ', y: ' + box_1.y + ', z: ' + box_1.z);
							console.log(box_1.sprite[0] + '/' + box_1.sprite[1] + '/' + box_1.sprite[2] + '/' + box_1.sprite[3]);
						}
					}, 1000/30);
				}
			}
		</script>
	</head>
	<body bgcolor='black'>

	</body>
</html>