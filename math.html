<!DOCTYPE html>
<html>
	<head>
		<title> math </title>
		<script>
			window.onload = function() {
				var math_hit = [], math_gravity = [];
				var objs = [], num = 0;
				var calEnd = 1, calGra = 0, calHit = 0;
				var mouseX, mouseY, mouseStatus = 1, tileXY = 25;

				document.body.innerHTML += '<b>마우스</b><br/><b>왼쪽</b> : 중력 블럭 생성<br/><b>휠버튼</b> : 블럭 삭제<br/><b>오른쪽</b> : 블럭 생성';

				var land = new crt('land');
				land.setSize(500, 50);
				land.setColor('gray');
				land.setAlpha(1);
				land.setPos(0,450);
				land.setHit(true);
				land.addParent(document.body);

				var mouse = new crt('mouse');
				mouse.setSize(tileXY, tileXY);
				mouse.setColor('green');
				mouse.setAlpha(0.5);
				mouse.setPos(0,0);
				mouse.addParent(document.body);

				window.onmousedown = makeNewObj;
				window.onmousemove = calMousePos;

				function makeNewObj() {
					if (mouseStatus == 1) {
						objs[num] = new crt('objs['+num+']');
						objs[num].setSize(tileXY, tileXY);
						objs[num].setWeight(25);
						objs[num].setColor('#009999');//Math.floor((Math.random()*899999 + 100000)));
						objs[num].setAlpha(1);
						objs[num].setPos(mouseX, mouseY);
						if (event.button == 0)
							objs[num].setGravity(true);
						objs[num].setHit(true);
						objs[num].addParent(document.body);
						num++;
					}
					if (mouseStatus == 0 && event.button == 1) {
						for (var i = 0, len = math_hit.length; i < len; i++) {
							eval("var chkObj_hit_tar = " + math_hit[i] + ";");
							if (hitTest(mouse, chkObj_hit_tar)) {
								chkObj_hit_tar.setGravity(false);
								chkObj_hit_tar.setHit(false);
								chkObj_hit_tar.removeParent(document.body);
								chkObj_hit_tar = null;
								i = math_hit.length;
							}
						}
					}
				}
				
				function calMousePos() {
					mouseX = Math.round((event.pageX - tileXY/2)/tileXY) * tileXY;
					mouseY = Math.round((event.pageY - tileXY/2)/tileXY) * tileXY;
					mouse.setPos(mouseX, mouseY);
					mouseHit();
					mouse.removeParent(document.body);
					mouse.addParent(document.body);
				}

				function mouseHit() {
					var mouseBool = false;
					for (var i = 0, len = math_hit.length; i < len; i++) {
						eval("var chkObj_hit_tar = " + math_hit[i] + ";");
						if (hitTest(mouse, chkObj_hit_tar)) {
							mouseBool = true;
							i = math_hit.length;
						}
					}

					if (mouseBool) {
						mouse.setColor('red');
						mouseStatus = 0;
					} else {
						mouse.setColor('green');
						mouseStatus = 1;
					}
				}

				function crt(id) {
					this.obj = document.createElement('img');
					this.obj.src = '';
					this.obj.style.cssText += 'position: absolute; background: #000000;';
					this.obj.id = id;
					this.gravity = false;
					this.weight = 0;
					this.powY = 0;
					this.hit = false;
					this.pastX = 0;
					this.pastY = 0;

					this.setColor = function(color) {
						this.obj.style.cssText += 'background: ' + color + ';';
					}

					this.getColor = function() {
						return this.obj.style.backgroundColor;
					}

					this.setAlpha = function(alpha) {
						this.obj.style.cssText += 'opacity: ' + alpha + ';';
					}

					this.getAlpha = function() {
						return this.obj.style.opacity;
					}
					
					this.addPos = function(x, y) {
						this.pastX = parseInt(this.obj.style.left);
						this.pastY = parseInt(this.obj.style.top);
						if (x != null || x != undefined)
							this.obj.style.left = parseInt(this.obj.style.left) + x + 'px';
						if (y != null || y != undefined)
							this.obj.style.top = parseInt(this.obj.style.top) + y + 'px';
					}
					
					this.setPos = function(x, y) {
						this.pastX = parseInt(this.obj.style.left);
						this.pastY = parseInt(this.obj.style.top);
						if (x != null || x != undefined)
							this.obj.style.left = x + 'px';
						if (y != null || y != undefined)
							this.obj.style.top = y + 'px';
					}
					
					this.getPos = function(x, y) {
						var returnValue = "";
						if (x == 1)
							returnValue += this.obj.style.left.replace("px", "");
						if (y == 1) {
							if (x == 1)
								returnValue += "/";
							returnValue += this.obj.style.top.replace("px", "");
						}
						return returnValue;
					}

					this.getMoveRotation = function() {
						var movX, movY, movS, movR = '';// S : Speed, R : Rotate
						movX = parseInt(this.obj.style.left) - this.pastX;
						movY = parseInt(this.obj.style.top) - this.pastY;
						if (movX != 0) {
							if (movX > 0)
								movR += 'R';
							else if (movX < 0)
								movR += 'L';
						}

						if (movY != 0) {
							if (movY > 0)
								movR += 'B';
							else if (movY < 0)
								movR += 'T';
						}
						movS = Math.sqrt(Math.pow(movX, 2) + Math.pow(movY, 2));
						return (movR + '/' + movS).split('/');
					}

					this.setSize = function(wd, hg) {
						this.obj.width = wd;
						this.obj.height = hg;
					}

					this.getSize = function(wd, hg) {
						var returnValue = "";
						if (wd == 1)
							returnValue += this.obj.width;
						if (hg == 1) {
							if (wd == 1)
								returnValue += "/";
							returnValue += this.obj.height;
						}
						return returnValue;
					}

					this.setWeight = function(weight) {
						this.weight = weight;
					}

					this.getWeight = function() {
						return this.weight;
					}

					this.setGravity = function(gra) {
						this.gravity = gra;
						if (gra == true)
							math_gravity.push(this.obj.id);
						else {
							for (var i = 0, len = math_gravity.length; i < len; i++) {
								if (math_gravity[i] == this.obj.id) {
									math_gravity.splice(i,1);
									return;
								}
							}
						}
					}

					this.getGravity = function() {
						return this.gravity;
					}

					this.setHit = function(ht) {
						this.hit = ht;
						if (ht == true)
							math_hit.push(this.obj.id);
						else {
							for (var i = 0, len = math_hit.length; i < len; i++) {
								if (math_hit[i] == this.obj.id) {
									math_hit.splice(i,1);
									return;
								}
							}
						}
					}

					this.getHit = function() {
						return this.hit;
					}

					this.addParent = function(parent) {
						parent.appendChild(this.obj);
					}

					this.removeParent = function(parent) {
						parent.removeChild(this.obj);
					}

					this.print = function() {
						console.log(this.obj);
					}
				}

				function cal() {
					if (calEnd == 1) {
						calEnd = 0;
						calGra = 0;
						calHit = 0;
						jump();
						hit();
					}
					if (calGra == 1 && calHit == 1) {
						calEnd = 1;
						calGra = 0;
						calHit = 0;
					}
				}

				function jump() {
					for (var i = 0, len = math_gravity.length; i < len; i++) {
						eval("var chkObj_gra = " + math_gravity[i] + ";");
						chkObj_gra.powY += Math.ceil((9.8 * chkObj_gra.weight * Math.abs(500 - chkObj_gra.getPos(0, 1))) / 250000);
						chkObj_gra.addPos(null, chkObj_gra.powY);
					}
					calGra = 1;
				}

				function hit() {
					for (var i = 0, leni = math_hit.length - 1; i < leni; i++) {
						eval("var chkObj_hit_ori = " + math_hit[i] + ";");
						for (var j = i + 1, lenj = math_hit.length; j < lenj; j++) {
							eval("var chkObj_hit_tar = " + math_hit[j] + ";");

							if (hitTest(chkObj_hit_ori, chkObj_hit_tar)) {
								var hitValue = chkObj_hit_tar.getMoveRotation(); //hitValue[1] 값은 이동속도 S = sqrt(X^2 + Y^2)
								
								if (hitValue[0].indexOf('R') != -1)
									chkObj_hit_tar.setPos(chkObj_hit_ori.getPos(1, 0) - chkObj_hit_tar.getSize(1, 0), null);
								else if (hitValue[0].indexOf('L') != -1)
									chkObj_hit_tar.setPos(chkObj_hit_ori.getPos(1, 0) + chkObj_hit_tar.getSize(1, 0), null);

								if (hitValue[0].indexOf('B') != -1) {
									if (chkObj_hit_tar.powY > 0)
										chkObj_hit_tar.powY = 0;
									chkObj_hit_tar.setPos(null, chkObj_hit_ori.getPos(0, 1) - chkObj_hit_tar.getSize(0, 1));
								} else if (hitValue[0].indexOf('T') != -1) {
									if (chkObj_hit_tar.powY < 0)
										chkObj_hit_tar.powY = 0;
									chkObj_hit_tar.setPos(null, chkObj_hit_ori.getPos(0, 1) + chkObj_hit_tar.getSize(0, 1));
								}
							}
						}
					}
					calHit = 1;
				}

				setInterval(function() {
					cal();
				}, 1000/30);

				function hitTest(ori, tar) {
					var oriX, oriY, oriW, oriH, tarX, tarY, tarW, tarH;

					oriX = parseInt(ori.getPos(1, 0));
					oriY = parseInt(ori.getPos(0, 1));
					oriW = parseInt(ori.getSize(1, 0));
					oriH = parseInt(ori.getSize(0, 1));
					tarX = parseInt(tar.getPos(1, 0));
					tarY = parseInt(tar.getPos(0, 1));
					tarW = parseInt(tar.getSize(1, 0));
					tarH = parseInt(tar.getSize(0, 1));

					if ((oriX + oriW > tarX && oriX < tarX + tarW) && (oriY + oriH > tarY && oriY < tarY + tarH))
						return true;

					return false;
				}
			}





		</script>
	</head>
	<body oncontextmenu="return false" ondragstart="return false" onselectstart="return false">
	</body>



<!--Æ®¸®¾ÆÁöX, ½Ã±Í, 스데-->
</html>
